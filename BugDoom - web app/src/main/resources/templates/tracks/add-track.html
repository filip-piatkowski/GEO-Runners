<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      layout:decorate="~{fragments/main_view}">
<head>
    <meta charset="UTF-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
        crossorigin=""/>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
          integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
          crossorigin=""></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <title>New track</title>
  <style>#map { height: 500px; }</style>
<!--  <style>#longitude_input, #latitude_input { display: none; }</style>-->
</head>
<body>
<div layout:fragment ="content" class="container text-left">
  <h1 >Nowa trasa</h1>

  <form th:action="@{/tracks}" th:object="${track}" method="post">

    <div style="margin-top: 5px">
    <p>Nazwa biegu: <input type="text" placeholder="Nazwa nowego biegu" th:field="*{competitionName}"/></p>
    </div>
    <div style="margin-top: 5px" >Poziom trudności:
      <input type="radio" id="difficultyChoice1" name="difficulty" value="łatwy"/>
      <label for="terrainChoice1">łatwy</label>
      <input type="radio" id="difficultyChoice2" name="difficulty" value="średni"/>
      <label for="terrainChoice2">średni</label>
      <input type="radio" id="difficultyChoice3" name="difficulty" value="trudny" th:field="*{difficulty}"/>
      <label for="terrainChoice3">trudny</label>
    </div>
    <p>Dystans (km): <input id="length_input" type="range" min="2" max="20" step="1" th:field="*{length}"/>
      <output id="value"></output>
    </p>
    <div style="margin-top: 5px"> Lokalizacja: <input type="radio" id="terrainChoice1" name="terrain" value="miejski"/>
      <label for="terrainChoice1">miejski</label>
      <input type="radio" id="terrainChoice2" name="terrain" value="leśny"/>
      <label for="terrainChoice2">leśny</label>
      <input type="radio" id="terrainChoice3" name="terrain" value="górzysty" th:field="*{terrain}"/>
      <label for="terrainChoice3">górzysty</label>
    </div>
    <div>
      <label for="event">Wydarzenie: </label>
      <select id="event" class="form-control" name="event.eventId">
        <option value="-1" th:text="#{track.select-event}"></option>
        <option th:each="event : ${allEvents}"
                th:value="${event.eventId}"
                th:text="${event.eventName}"></option>
      </select>
    </div>

    <div style="margin-top: 5px">
      <p>Start (współrzędne): <input type="text" placeholder="start" id="coordinate_input" onchange="splitCoordinates()"/></p>
    </div>
    <div style="margin-top: 5px">
      <p>Start (długość geograficzna): <input type="text" placeholder="start" id="longitude_input" /></p>
    </div>
    <div style="margin-top: 5px">
      <p>Start (szerokość geograficzna): <input type="text" placeholder="start" id="latitude_input"/></p>
    </div>


    <div id="map" class="container"></div>
    <ul th:if="${#fields.hasErrors('*')}">
      <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
    </ul>
    <p><input class="btn btn-success" type="submit" value="Zatwierdź"/>
      <input class="btn btn-secondary" type="reset" value="Zresetuj"/></p>
  </form>

  <a href="/tracks" class="btn btn-primary"><i class="fas fa-angle-double-left"></i> Powrót do listy tras</a>
  <script>
    const value = document.querySelector("#value")
    const input = document.querySelector("#length_input")
    value.textContent = input.value
    input.addEventListener("input", (event) => {
      value.textContent = event.target.value
    })
  </script>

  <script th:inline="javascript">


    var options = { center: [54.349, 18.651], zoom: 12 };
    var map = L.map('map', options);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    map.on('click', function(e) {
      var lt = String(e.latlng.lat),
              lg = String(e.latlng.lng);
      var popup = L.popup()
              .setLatLng(e.latlng)
              .setContent("Kopiuj współrzędne\n" + lt + "," + lg)
              .openOn(map);
    });
    function splitCoordinates() {
      var coordinateInput = document.getElementById("coordinate_input").value;
      var coordinates = coordinateInput.split(/[ ,]+/);

      if (coordinates.length >= 2) {
        var longitudeInput = document.getElementById("longitude_input");
        var latitudeInput = document.getElementById("latitude_input");

        longitudeInput.value = coordinates[0];
        latitudeInput.value = coordinates[1];
      }
    }

    function splitCoordinates() {
      var coordinateInput = document.getElementById("coordinate_input").value;
      var coordinates = coordinateInput.split(/[ ,]+/);

      if (coordinates.length >= 2) {
        var longitudeInput = document.getElementById("longitude_input");
        var latitudeInput = document.getElementById("latitude_input");

        longitudeInput.value = coordinates[0];
        latitudeInput.value = coordinates[1];
      }
    }
  </script>
</div>

</body>


</html>